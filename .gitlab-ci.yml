.flatpak:
  tags:
    - flatpak
  variables:
      EXIV2_REF: 'main'
  image: quay.io/gnome_infrastructure/gnome-runtime-images:gnome-master
  stage: build
  script:
    - sed build-aux/org.gnome.GExiv2.json.in -e "s/@EXIV2_REF@/${EXIV2_REF}/" > org.gnome.GExiv2.json
    - flatpak-builder build-dir org.gnome.GExiv2.json --stop-at=gexiv2 --user --disable-rofiles-fuse
    - flatpak build build-dir meson _build -Dtests=false --cross-file=build-aux/x86_64-linux-clang.txt
    - flatpak build build-dir ninja -C _build
    - flatpak build build-dir ninja -C _build test
  artifacts:
    when: on_failure
    name: "gexiv2-_${CI_COMMIT_REF_NAME}"
    paths:
      - "${CI_PROJECT_DIR}/_build/meson-logs"

exiv2-0-28@aarch64:on-schedule:
  extends: .flatpak
  variables:
    EXIV2_REF: "0.28.x"
  tags:
    - flatpak-aarch64


